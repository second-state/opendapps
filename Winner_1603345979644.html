<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Winner</title>
    
    <style type="text/css">
    button {
  background-color: #000;
  color: #fff;
  border: 0;
  font-size: 1em;
}
    </style>
  </head>
  <body>
    <!-- <button id="s">Set Data</button> -->
<!-- <button id="g">Get Data</button> -->
 标    题：<input id="pro_title" name="title"/><br/><br/>
 描    述：<input id="pro_describe" name="describe"/><br/><br/>
 通 过 率：<input id="pro_passRate" name="passRate"type="number" oninput="if(value.length>2)value=value.slice(0,2)" /><br/><br/>
 截止时间：<input id="pro_expiryDate" name="expiryDate" type="date"/><br/><br/>
 <button id="addProposalBt">发布提案</button>
<br/><br/>
<br/><br/>
<br/><br/>
选择提案：<select id="vote_proposals" name="proposalId" style="width:100px;" onselect="selectFunction(this.value)"></select>&nbsp&nbsp&nbsp&nbsp
        <button id="refreshProposalsBt">刷新提案列表</button><br/><br/>
        <input id="radio1" value="1" type="radio" name="vote"/>赞成
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <input id="radio2" value="2" type="radio" name="vote"/>反对 <br/><br/>
        <button id="votedBt"> 投  票 </button><br/><br/>




    <script type="text/javascript">
    window.BuidlProviders = {
      web3: {
        url: "https://rpc.oasiseth.org:8545",
        chainId: "69",
        gasPrice: "1",
        gasLimit: "8000000",
      },
      es: {
        url: "https://devchain.ss.search.secondstate.io"
      }
    }
    </script>
    <script type="text/javascript" src="https://buidl.secondstate.io/embed/main.js"></script>
    
    <script type="text/javascript">
    /* Don't modify */
var abi = [{"constant":true,"inputs":[{"name":"proposalId","type":"uint256"}],"name":"cxVoted","outputs":[{"name":"","type":"string"},{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"print","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[],"name":"getProposalList","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"x","type":"uint256"}],"name":"set","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"get","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getLenght","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"i","type":"uint256"}],"name":"getProposalTitle","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"title","type":"string"},{"name":"describe","type":"string"},{"name":"passRate","type":"int256"},{"name":"expiryDate","type":"uint256"}],"name":"addProposal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"},{"name":"vote","type":"int256"}],"name":"voted","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}];
var bytecode = '6060604052341561000f57600080fd5b610bb38061001e6000396000f300606060405260043610610099576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305c0b54f1461009e57806313bdfacd1461016d578063346750f3146101fb57806360fe47b1146102655780636d4ce63c14610288578063bed2a42e146102b1578063cbba67f2146102da578063cc78e03714610376578063df2355ef14610428575b600080fd5b34156100a957600080fd5b6100bf6004808035906020019091905050610454565b60405180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b83811015610131578082015181840152602081019050610116565b50505050905090810190601f16801561015e5780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b341561017857600080fd5b610180610549565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101c05780820151818401526020810190506101a5565b50505050905090810190601f1680156101ed5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561020657600080fd5b61020e61058c565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b83811015610251578082015181840152602081019050610236565b505050509050019250505060405180910390f35b341561027057600080fd5b6102866004808035906020019091905050610635565b005b341561029357600080fd5b61029b61063f565b6040518082815260200191505060405180910390f35b34156102bc57600080fd5b6102c4610648565b6040518082815260200191505060405180910390f35b34156102e557600080fd5b6102fb6004808035906020019091905050610655565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561033b578082015181840152602081019050610320565b50505050905090810190601f1680156103685780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561038157600080fd5b610426600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091908035906020019091908035906020019091905050610730565b005b341561043357600080fd5b6104526004808035906020019091908035906020019091905050610856565b005b61045c61098e565b60008060018481548110151561046e57fe5b906000526020600020906008020160070160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141561050757336040805190810160405280600a81526020017fe69caae68a95e7a5a820000000000000000000000000000000000000000000008152509091509150610544565b336040805190810160405280600981526020017fe5b7b2e68a95e7a5a8000000000000000000000000000000000000000000000081525090915091505b915091565b61055161098e565b6040805190810160405280600c81526020017fe699bae883bde59088e7baa60000000000000000000000000000000000000000815250905090565b6105946109a2565b600080600090505b6001805490508110156105de578180548060010182816105bc91906109b6565b916000526020600020900160008390919091505550808060010191505061059c565b8180548060200260200160405190810160405280929190818152602001828054801561062957602002820191906000526020600020905b815481526020019060010190808311610615575b50505050509250505090565b8060008190555050565b60008054905090565b6000600180549050905090565b61065d61098e565b60018054905082101561072a5760018281548110151561067957fe5b90600052602060002090600802016000018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561071e5780601f106106f35761010080835404028352916020019161071e565b820191906000526020600020905b81548152906001019060200180831161070157829003601f168201915b5050505050905061072b565b5b919050565b6001805480600101828161074491906109e2565b9160005260206000209060080201600060e060405190810160405280888152602001878152602001600281526020018681526020014281526020018581526020013373ffffffffffffffffffffffffffffffffffffffff16815250909190915060008201518160000190805190602001906107c0929190610a14565b5060208201518160010190805190602001906107dd929190610a14565b5060408201518160020155606082015181600301556080820151816004015560a0820151816005015560c08201518160060160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050505050505050565b600060018381548110151561086757fe5b906000526020600020906008020160070160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141561098a57806001838154811015156108cf57fe5b906000526020600020906008020160070160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001819055504260018381548110151561093457fe5b906000526020600020906008020160070160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101819055505b5050565b602060405190810160405280600081525090565b602060405190810160405280600081525090565b8154818355818115116109dd578183600052602060002091820191016109dc9190610a94565b5b505050565b815481835581811511610a0f57600802816008028360005260206000209182019101610a0e9190610ab9565b5b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610a5557805160ff1916838001178555610a83565b82800160010185558215610a83579182015b82811115610a82578251825591602001919060010190610a67565b5b509050610a909190610a94565b5090565b610ab691905b80821115610ab2576000816000905550600101610a9a565b5090565b90565b610b3c91905b80821115610b385760008082016000610ad89190610b3f565b600182016000610ae89190610b3f565b60028201600090556003820160009055600482016000905560058201600090556006820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff021916905550600801610abf565b5090565b90565b50805460018160011615610100020316600290046000825580601f10610b655750610b84565b601f016020900490600052602060002090810190610b839190610a94565b5b505600a165627a7a72305820aef031ab92d6c0a55103644a9938f4e5638d3caa33de177df9b02d0ce32d2dfb0029';
var cAddr = '0x07d02070cd09a4da9b9b26131bfb22b66f601ad7';
/* Don't modify */

var instance = null;
window.addEventListener('web3Ready', function() {
  var contract = web3.ss.contract(abi);
  instance = contract.at(cAddr);
});

// document.querySelector("#s").addEventListener("click", function() {
//   var n = window.prompt("Enter the number:");
//   n && instance.set(n);
// });
// document.querySelector("#g").addEventListener("click", function() {
//   instance.get(function(e,d) {
//     console.log(d.toString());
//     alert(d.toString());
//   });
// });

//添加提案
document.querySelector("#addProposalBt").addEventListener("click", function() {
  var proTitle = document.getElementById("pro_title").value;
  if(proTitle == null || proTitle.length == 0){
    alert("请填写提案标题！");
    return;
  }
  var proDescribe = document.getElementById("pro_describe").value;
  if(proDescribe == null || proDescribe.length == 0){
    alert("请填写提案描述！");
    return;
  }
  var proPassRate = document.getElementById("pro_passRate").value;
  if(proPassRate == null || proPassRate.length == 0){
    alert("请设置通过率！");
    return;
  }
  var proExpiryDate = document.getElementById("pro_expiryDate").value;
  if(proExpiryDate == null || proExpiryDate.length == 0){
    alert("请选择截止日期！");
    return;
  }
  //addProposal(string title,string describe,int passRate,uint expiryDate)
  instance.addProposal(proTitle,proDescribe,proPassRate,Date.now());
});

// 刷新提案列表 
document.querySelector("#refreshProposalsBt").addEventListener("click", function() {
  var indexs  = instance.getProposalList();
  var objSelectNow = document.getElementById("vote_proposals");
  objSelectNow.options.length = 0;
  if(indexs.length == 0){
    alert("暂时没有提案,赶快发布一个吧！");
    return;
  }
  for(var i = 0 ; i < indexs.length ; i++ ){
    var objOption = document.createElement("OPTION");
    objOption.text = instance.getProposalTitle(Number(indexs[i]));
    objOption.value = Number(indexs[i]);
    objSelectNow.options.add(objOption);
  }
});

//投票
document.querySelector("#votedBt").addEventListener("click", function() {
    //获取所选择的提案索引
    var objSelectNow = document.getElementById("vote_proposals");
    var selectValue = objSelectNow.value;
    if(selectValue == null || selectValue.length == 0){
      alert("请选择要投票的提案!");
      return;
    }
    var radios = document.getElementsByName("vote");
    var voteValue = 0;
    for(var i=0;i<radios.length;i++){
      if(radios[i].checked == true){
        voteValue = radios[i].value;
      }
    }
    if(voteValue == 0){
      alert("请选择赞成或者反对!");
      return;
    }
    instance.voted(Number(selectValue),Number(voteValue));
});

document.querySelector("#g").addEventListener("click", function() {
  var objSelectNow = document.getElementById("vote_proposals");
    var selectValue = objSelectNow.value;
    if(selectValue == null || selectValue.length == 0){
      alert("请选择要投票的提案!");
      return;
    }
  alert(instance.cxVoted(Number(selectValue)));
  alert(selectValue);
});

    </script>
  </body>
</html>