<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>OasisKing</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <style type="text/css">
    button {
  background-color: #000;
  color: #fff;
  border: 0;
  font-size: 1em;
}
    </style>
  </head>
  <body>
    <h2 class="container">&nbsp;</h2>
<h2 class="container" style="text-align: center;"><strong>**King of the Hill** </strong></h2>
<div class="container">&nbsp;
<table style="width: 776px;">
<tbody>
<tr>
<td style="width: 197px;">&nbsp;</td>
<td style="width: 583px;">
<div class="container">Rules:</div>
<div class="container">- Manage two subsequent presses of the button, <em>N</em> or more blocks apart.</div>
<div class="container">- No presses from other addresses should occur between yours.</div>
<div class="container">- Each time the button is pressed, the counter starts over.</div>
<div class="container">- Each time someone wins <em>N</em> increases by 1.</div>
<div class="container">- Each button press costs 0.1 OETH.</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="container">&nbsp;</div>
<div class="container">&nbsp;</div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;"><strong>The winner takes it all.</strong></div>
<div class="container" style="text-align: center;"><strong>The game never ends.</strong></div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;">Balance<br /><br /></div>
<h1 class="container" style="text-align: center; font-size: 45px;">&nbsp;</h1>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container"><br />
<div class="jumbotron" style="text-align: center;"><form id="form">
<div class="form-group"><label for="comment">Comment (optional)</label> <input id="comment" class="form-control" type="text" placeholder="" /></div>
<button id="submit" class="btn btn-primary" type="button">KING</button></form>
<div id="formSubmitted" style="display: none;">Please wait up to 10 seconds for confirmation ...</div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align: center;" scope="col">Address</th>
<th style="text-align: center;" scope="col">Comment</th>
<th style="text-align: center;" scope="col">Block</th>
</tr>
</thead>
<tbody id="comments"></tbody>
</table>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">All data recorded on the <a href="https://www.oasiseth.org" target="_blank" rel="noopener">Oasis Ethereum</a> blockchain network.</p>
</div>

    <script type="text/javascript">
    window.BuidlProviders = {
      web3: {
        url: "https://rpc.oasiseth.org:8545",
        chainId: "69",
        gasPrice: "1",
        gasLimit: "8000000",
      },
      es: {
        url: "https://rpc.oasiseth.org:8545"
      }
    }
    </script>
    <script type="text/javascript" src="https://buidl.secondstate.io/embed/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
    /* Don't modify */
var abi = [{"constant":false,"inputs":[{"internalType":"string","name":"_comment","type":"string"}],"name":"addPress","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCounter","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getPress","outputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"string","name":"","type":"string"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"min_distance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"price","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}];
var bytecode = '6080604052662386f26fc100006001556001600255600060065534801561002557600080fd5b506107e9806100356000396000f3fe6080604052600436106100555760003560e01c806312065fe01461005a5780633bcf1874146100855780638ada066e1461017e578063a035b1fe146101a9578063e34e7790146101d4578063f0e967cf1461028f575b600080fd5b34801561006657600080fd5b5061006f6102ba565b6040518082815260200191505060405180910390f35b34801561009157600080fd5b506100be600480360360208110156100a857600080fd5b81019080803590602001909291905050506102c2565b604051808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018060200184815260200183151515158152602001828103825285818151815260200191508051906020019080838360005b83811015610140578082015181840152602081019050610125565b50505050905090810190601f16801561016d5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34801561018a57600080fd5b506101936103fc565b6040518082815260200191505060405180910390f35b3480156101b557600080fd5b506101be610406565b6040518082815260200191505060405180910390f35b61028d600480360360208110156101ea57600080fd5b810190808035906020019064010000000081111561020757600080fd5b82018360208201111561021957600080fd5b8035906020019184600183028401116401000000008311171561023b57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929050505061040c565b005b34801561029b57600080fd5b506102a4610709565b6040518082815260200191505060405180910390f35b600047905090565b600060606000806005600086815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166005600087815260200190815260200160002060010160056000888152602001908152602001600020600201546005600089815260200190815260200160002060030160009054906101000a900460ff16828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156103e65780601f106103bb576101008083540402835291602001916103e6565b820191906000526020600020905b8154815290600101906020018083116103c957829003601f168201915b5050505050925093509350935093509193509193565b6000600654905090565b60015481565b60015434101561041b57600080fd5b3373ffffffffffffffffffffffffffffffffffffffff16600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614801561047e5750600254600454430310155b156105d15760405180608001604052803373ffffffffffffffffffffffffffffffffffffffff1681526020018281526020014381526020016001151581525060056000600654815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101908051906020019061053592919061070f565b506040820151816002015560608201518160030160006101000a81548160ff021916908315150217905550905050600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f193505050501580156105cb573d6000803e3d6000fd5b506106b2565b60405180608001604052803373ffffffffffffffffffffffffffffffffffffffff1681526020018281526020014381526020016000151581525060056000600654815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101908051906020019061068392919061070f565b506040820151816002015560608201518160030160006101000a81548160ff0219169083151502179055509050505b4360048190555033600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060016006540160068190555050565b60025481565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061075057805160ff191683800117855561077e565b8280016001018555821561077e579182015b8281111561077d578251825591602001919060010190610762565b5b50905061078b919061078f565b5090565b6107b191905b808211156107ad576000816000905550600101610795565b5090565b9056fea265627a7a7231582070d0559c447b2a4652b6a4fd87f59f0561f8ef3cab7bdb64070ba1119bf3f31464736f6c63430005110032';
var cAddr = '0x4f9c63f136cbef871231ac7a1a059e3b584b4412';
/* Don't modify */

var instance = null;
window.addEventListener('web3Ready', function() {
  var contract = web3.ss.contract(abi);
  instance = contract.at(cAddr);
  reload();
});

//var price = "10000000000000000"; // This is in the unit of OETH. e.g., 0.01

var hill = instance.getBalance()/10000000000000000;
$("#hill").html(hill + " OETH");

function reload() {
    //instance.price(function (e, r) {
    //    price = r;
    //    $("#pricealert").html("Requires " + price + " wei to comment");
    //});
    
    $("#formSubmitted").css("display", "none");
    web3.ss.getAccounts(function (e, address) {
        if (!e) {
            var balance = web3.ss.getBalance(address[0]);
            $("#balance").html("You have " + balance + " wei OETH in your current account. ");
            var hill = instance.getBalance()/10000000000000000;
            $("#hill").html(hill + " OETH");

            var comments = "";
            var counter = instance.getCounter();
            for (i = counter-1; i >= 0; i--) {
                    var r = instance.getPress(parseInt(i));    
                    comments = comments + "<tr><td>" + r[0] + "</td><td>" + r[1] + "</td><td>" + r[2] + "</td></tr>";
                    $("#comments").html(comments);   
            }
            $("#comments").html(comments);
        }
    });
}


$("#submit").click(function() {
    web3.ss.getAccounts(function (e, address) {
        if (!e) {
            $("#form").css("display", "none");
            $("#formSubmitted").css("display", "block");
            instance.addPress ($("#comment").val(), {
                value: price,
                gas: 499000,
                gasPrice: 1
            }, function (ee, r) {
                if (ee) {
                    window.alert("You need to pay " + price + " OETH to comment. Make sure that you have it in your address.");
                }
            });
            setTimeout(function () {
                reload ();
            }, 10 * 1000);
        }
    });
    return false;
});

window.setInterval(function(){
  reload();
}, 15000);

    </script>
  </body>
</html>