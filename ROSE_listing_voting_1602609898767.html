<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>ROSE listing voting</title>
    
    <style type="text/css">
    button {
  background-color: #000;
  color: #fff;
  border: 0;
  font-size: 1em;
}
    </style>
  </head>
  <body>
    <!DOCTYPE html>
<html>
<head>
 <title>ROSE listing</title>
 <link href='https://fonts.googleapis.com/css?family=Open Sans:400,700' rel='stylesheet' type='text/css'>
 <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
</head>
<body class="container">
 <h1>Where to list ROSE: The Oasis Network Token?</h1>
 <div class="table-responsive">
  <table class="table table-bordered">
   <thead>
    <tr>
     <th>Exchange</th>
     <th>Votes</th>
    </tr>
   </thead>
   <tbody>
    <tr>
     <td>Uniswap</td>
     <td id="candidate-1"></td>
    </tr>
    <tr>
     <td>Binance</td>
     <td id="candidate-2"></td>
    </tr>
    <tr>
     <td>Coinbase</td>
     <td id="candidate-3"></td>
    </tr>
   </tbody>
  </table>
 </div>
 <input type="text" id="candidate" />
 <a href="#" onclick="voteForCandidate()" class="btn btn-primary">Vote</a>
</body>
<script charset="utf-8"
        src="https://cdn.ethers.io/scripts/ethers-v4.min.js"
        type="text/javascript">
</script>
<script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
<script src="./index.js"></script>
</html>

    <script type="text/javascript">
    window.BuidlProviders = {
      web3: {
        url: "https://rpc.oasiseth.org:8545",
        chainId: "69",
        gasPrice: "1",
        gasLimit: "8000000",
      },
      es: {
        url: "https://devchain.ss.search.secondstate.io"
      }
    }
    </script>
    <script type="text/javascript" src="https://buidl.secondstate.io/embed/main.js"></script>
    
    <script type="text/javascript">
    /* Don't modify */
var abi = [{"constant":true,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"totalVotesFor","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"validCandidate","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"votesReceived","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"candidateList","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"candidate","type":"bytes32"}],"name":"voteForCandidate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"candidateNames","type":"bytes32[]"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];
var bytecode = '608060405234801561001057600080fd5b506040516103d43803806103d4833981018060405281019080805182019291905050508060019080519060200190610049929190610050565b50506100c8565b828054828255906000526020600020908101928215610092579160200282015b82811115610091578251829060001916905591602001919060010190610070565b5b50905061009f91906100a3565b5090565b6100c591905b808211156100c15760008160009055506001016100a9565b5090565b90565b6102fd806100d76000396000f30060806040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632f265cf714610072578063392e6678146100b75780637021939f14610100578063b13c744b14610145578063cc9ab2671461018e575b600080fd5b34801561007e57600080fd5b506100a160048036038101908080356000191690602001909291905050506101bf565b6040518082815260200191505060405180910390f35b3480156100c357600080fd5b506100e660048036038101908080356000191690602001909291905050506101f7565b604051808215151515815260200191505060405180910390f35b34801561010c57600080fd5b5061012f6004803603810190808035600019169060200190929190505050610256565b6040518082815260200191505060405180910390f35b34801561015157600080fd5b506101706004803603810190808035906020019092919050505061026e565b60405180826000191660001916815260200191505060405180910390f35b34801561019a57600080fd5b506101bd6004803603810190808035600019169060200190929190505050610291565b005b60006101ca826101f7565b15156101d557600080fd5b6000808360001916600019168152602001908152602001600020549050919050565b600080600090505b60018054905081101561024b57826000191660018281548110151561022057fe5b906000526020600020015460001916141561023e5760019150610250565b80806001019150506101ff565b600091505b50919050565b60006020528060005260406000206000915090505481565b60018181548110151561027d57fe5b906000526020600020016000915090505481565b61029a816101f7565b15156102a557600080fd5b6001600080836000191660001916815260200190815260200160002060008282540192505081905550505600a165627a7a72305820722eee6c3be2ab3de166d0b2f7eec7630dd15ac1f7e5f01d1c4e72f3b99b85910029';
var cAddr = '';
/* Don't modify */

web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
abi = JSON.parse('[{"constant":true,"inputs":[],"name":"wellcomeString","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newWellcomeString","type":"string"}],"name":"setWellcomeString","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}]');
WellcomeContract = web3.eth.contract(abi);
contractInstance = WellcomeContract.at('0xc04d0c1bb4984b3a158a780ff3bfc0561484917f');

provider = = new ethers.providers.Web3Provider (web3.currentProvider);
signer = provider.getSigner(0);
contract = new ethers.Contract('0x5735731eEbDA5BE1eEe9f0b119B9374a63b0f507', abi, signer)

candidates = {"Uniswap": "candidate-1", "Binance": "candidate-2", "Coinbase": "candidate-3"}

function voteForCandidate(candidate) {
 candidateName = $("#candidate").val();
  console.log(candidateName);

  contract.voteForCandidate(ethers.utils.formatBytes32String(candidateName)).then((f) => {
    let div_id = candidates[candidateName];
    contract.totalVotesFor(ethers.utils.formatBytes32String(candidateName)).then((f) => {
      $("#" + div_id).html(f);
    })
  });
}

$(document).ready(function() {
  
 candidateNames = Object.keys(candidates);

 for(var i=0; i<candidateNames.length; i++) {
  let name = candidateNames[i];
  contract.totalVotesFor(ethers.utils.formatBytes32String(name)).then((f) => {
    $("#" + candidates[name]).html(f);
  })
 }
});
    </script>
  </body>
</html>