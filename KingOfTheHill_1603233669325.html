<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>KingOfTheHill</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <style type="text/css">
    button {
  background-color: #000;
  color: #fff;
  border: 0;
  font-size: 1em;
}
    </style>
  </head>
  <body>
    <h2 class="container">&nbsp;</h2>
<h2 class="container" style="text-align: center;"><strong>King of the Hill </strong></h2>
<div class="container">&nbsp;
<table style="width: 568.5px; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="width: 10px;">&nbsp;</td>
<td style="width: 562.5px;">
<div class="container">Rules:</div>
<div class="container">- Manage two subsequent presses of the button, <em>N</em> or more blocks apart.</div>
<div class="container">- No presses from other addresses should occur between yours.</div>
<div class="container">- Each time the button is pressed, the counter starts over.</div>
<div class="container">- Each time someone wins <em>N</em> increases by 1.</div>
<div class="container">- Each button press costs 0.1 OETH.</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;"><strong>The winner takes it all.</strong></div>
<div class="container" style="text-align: center;"><strong>The game never ends.</strong></div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;">&nbsp;</div>

<h1 class="container" style="text-align: center; font-size: 45px;" id="hill"></h1>
<h1 class="container" style="text-align: center; font-size: 45px;" id="distance"></h1>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container" style="text-align: center;">&nbsp;</div>
<div class="container"><br />
<div class="jumbotron" style="text-align: center;"><form id="form">
<div class="form-group"><label for="comment">Comment (optional)</label> <input id="comment" class="form-control" type="text" placeholder="" /></div>
<button id="submit" class="btn btn-primary" type="button">KING</button></form>
<div id="formSubmitted" style="display: none;">Please wait up to 10 seconds for confirmation ...</div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<table class="table table-striped" style="margin-left: auto; margin-right: auto; width:100%">
<thead>
<tr>
<th style="text-align: center;" scope="col">Address</th>
<th style="text-align: center;" scope="col">Comment</th>
<th style="text-align: center;" scope="col">Block</th>
<th style="text-align: center;" scope="col">Wins</th>
</tr>
</thead>
<tbody id="presses"></tbody>
</table>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;"><a href="https://mavroud.is" target="_blank" rel="noopener">Vasilios Mavroudis</a></p>
</div>

    <script type="text/javascript">
    window.BuidlProviders = {
      web3: {
        url: "https://rpc.oasiseth.org:8545",
        chainId: "69",
        gasPrice: "1",
        gasLimit: "8000000",
      },
      es: {
        url: "https://rpc.oasiseth.org:8545"
      }
    }
    </script>
    <script type="text/javascript" src="https://buidl.secondstate.io/embed/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
    /* Don't modify */
var abi = [{"constant":false,"inputs":[{"internalType":"string","name":"comment","type":"string"}],"name":"addPress","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"climbers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"distance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getPress","outputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"string","name":"","type":"string"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"bool","name":"","type":"bool"},{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"last_block","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"max_distance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"price","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}];
var bytecode = '6080604052600180556001600255600a60035560006004556000600760006101000a81548160ff02191690831515021790555034801561003e57600080fd5b506108f78061004e6000396000f3fe6080604052600436106100705760003560e01c8063438d94ac1161004e578063438d94ac146101cb5780634851375c146101f6578063a035b1fe14610221578063e34e77901461024c57610070565b806314315f011461007557806329384524146100a05780633bcf1874146100cb575b600080fd5b34801561008157600080fd5b5061008a610307565b6040518082815260200191505060405180910390f35b3480156100ac57600080fd5b506100b561030d565b6040518082815260200191505060405180910390f35b3480156100d757600080fd5b50610104600480360360208110156100ee57600080fd5b8101908080359060200190929190505050610313565b604051808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018060200185815260200184151515158152602001838152602001828103825286818151815260200191508051906020019080838360005b8381101561018c578082015181840152602081019050610171565b50505050905090810190601f1680156101b95780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390f35b3480156101d757600080fd5b506101e061046a565b6040518082815260200191505060405180910390f35b34801561020257600080fd5b5061020b610470565b6040518082815260200191505060405180910390f35b34801561022d57600080fd5b50610236610476565b6040518082815260200191505060405180910390f35b6103056004803603602081101561026257600080fd5b810190808035906020019064010000000081111561027f57600080fd5b82018360208201111561029157600080fd5b803590602001918460018302840111640100000000831117156102b357600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929050505061047c565b005b60035481565b60045481565b6000606060008060006008600087815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600860008881526020019081526020016000206001016008600089815260200190815260200160002060020154600860008a815260200190815260200160002060030160009054906101000a900460ff16600860008b815260200190815260200160002060040154838054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104505780601f1061042557610100808354040283529160200191610450565b820191906000526020600020905b81548152906001019060200180831161043357829003601f168201915b505050505093509450945094509450945091939590929450565b60065481565b60025481565b60015481565b60015434101561048b57600080fd5b60006004541180156104b0575060001515600760009054906101000a900460ff161515145b801561050957503373ffffffffffffffffffffffffffffffffffffffff16600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b801561051b5750600254600654430310155b156106b3576040518060a001604052803373ffffffffffffffffffffffffffffffffffffffff16815260200182815260200143815260200160011515815260200160045481525060086000600454815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010190805190602001906105da92919061081d565b506040820151816002015560608201518160030160006101000a81548160ff021916908315150217905550608082015181600401559050506001600760006101000a81548160ff021916908315150217905550600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60649081150290604051600060405180830381858888f19350505050158015610696573d6000803e3d6000fd5b506001600354600254816106a657fe5b06016002819055506107c1565b6040518060a001604052803373ffffffffffffffffffffffffffffffffffffffff16815260200182815260200143815260200160001515815260200160045481525060086000600454815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101908051906020019061076d92919061081d565b506040820151816002015560608201518160030160006101000a81548160ff021916908315150217905550608082015181600401559050506000600760006101000a81548160ff0219169083151502179055505b4360068190555033600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600160046000828254019250508190555050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061085e57805160ff191683800117855561088c565b8280016001018555821561088c579182015b8281111561088b578251825591602001919060010190610870565b5b509050610899919061089d565b5090565b6108bf91905b808211156108bb5760008160009055506001016108a3565b5090565b9056fea265627a7a72315820b082b3c8fbdafdfbeae2385aa26530821fd153eb5eca22c5816eedbf6ff8155964736f6c63430005110032';
var cAddr = '0xb6ab342a8afd2ab2c1632ba1bfbb5d5e0f3bd8cc';
/* Don't modify */

var instance = null;
var price = 0.01;
var climbers = 0;
var hill = 0;
var distance = 0;
var presses = {};



window.addEventListener('web3Ready', function() {
  var contract = web3.ss.contract(abi);
  instance = contract.at(cAddr);
  reload();
});


function reload() {
    $("#formSubmitted").css("display", "none");
    instance.price(function (e, r) {
        //price = r;
    });

    instance.climbers(function (e, r) {
       climbers = parseInt(r);
    });

    instance.distance(function (e, r) {
       distance = parseInt(r);
    });

    var hill = web3.ss.getBalance(cAddr);
    hill = parseInt(hill)/1000;
    $("#hill").html(hill.toFixed(3) + " OETH");
    $("#distance").html(distance + " Blocks");


    web3.ss.getAccounts(function (e, address) {
        if (!e) {
            for (i = climbers-1; i >= 0; i--) {
                instance.getPress(i, function(error, r) {
                    if(error) {
                        console.log(error);
                    }
                    presses[parseInt(r[4])] = r;
                });
            }

            var comments = "";
            for (i = climbers-1; i >= 0; i--) {
                var r = presses[i];
                comments = comments + "<tr><td style=\"text-align: center;\">" + r[0] + "</td><td style=\"text-align: center;\">" + r[1] + "</td><td style=\"text-align: center;\">" + r[2] + "</td><td style=\"text-align: center;\">" + r[3] + "</td></tr>";
            }
            $("#presses").html(comments);
        }
    });
}


$("#submit").click(function() {
    web3.ss.getAccounts(function (e, address) {
        if (!e) {
            //$("#form").css("display", "none");
            $("#formSubmitted").css("display", "block");
            
            instance.addPress($("#comment").val(), {
                value: 100,
                gas: 499000,
                gasPrice: 1
            },function(error, result) {
                if(error) {
                    console.log(error);
                }
            });
        }
    });
    return false;
});

window.setInterval(function(){
  reload();
}, 5*1000);


    </script>
  </body>
</html>