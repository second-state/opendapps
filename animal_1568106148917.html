<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>animal</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <style type="text/css">
    button {
  background-color: #000;
  color: #fff;
  border: 0;
  font-size: 1em;
}
    </style>
  </head>
  <body>
    <div class="container">
    <br/>
    <div class="jumbotron">
        <p class="lead" id="greeting"></p>
        <hr/>
        <form id="form">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" placeholder="">
            </div>
            <div class="form-group">
                <label for="comment">Comment</label>
                <input type="text" class="form-control" id="comment" placeholder="">
            </div>
            <button type="button" id="submit" class="btn btn-primary">Send Comment</button>
        </form>
        <p id="me" style="display:none">Thank you, <span id="myname" class="badge badge-info"></span></p>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Comment</th>
            </tr>
        </thead>
        <tbody id="likes">
        </tbody>
    </table>
</div>

    <script type="text/javascript">
    window.BuidlProviders = {
      web3: {
        url: "https://devchain.secondstate.io:8545",
        chainId: "27183",
        gasPrice: "0",
        gasLimit: "8192000000",
      },
      es: {
        url: "https://devchain.ss.search.secondstate.io"
      }
    }
    </script>
    <script type="text/javascript" src="https://buidl.secondstate.io/embed/index.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
    /* Don't modify */
var abi = [{"constant":true,"inputs":[],"name":"getAddrs","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_addr","type":"address"},{"name":"_name","type":"string"},{"name":"_comment","type":"string"}],"name":"addComment","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_addr","type":"address"}],"name":"getNameComment","outputs":[{"name":"","type":"string"},{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"greeting","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}];
var bytecode = '608060405234801561001057600080fd5b5060405161091f38038061091f833981018060405281019080805182019291905050508060009080519060200190610049929190610050565b50506100f5565b82805460018160011615610100020d166002900490600052602060002090601f016020900481019282601f1061009157805160ff19168380011785556100bf565b828001600101855582156100bf579182015b828111156100be5782518255916020019190600101906100a3565b5b5090506100cc91906100d0565b5090565b6100f291905b808211156100ee5760008160009055506001016100d6565b5090565b90565b61081b806101046000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680633f416eb31461006757806384a783cb146100d3578063ee202e03146101a2578063ef690cc0146102ca575b600080fd5b34801561007357600080fd5b5061007c61035a565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156100bf5780820151818401526020810190506100a4565b505050509050019250505060405180910390f35b3480156100df57600080fd5b506101a0600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506103e8565b005b3480156101ae57600080fd5b506101e3600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506104e4565b604051808060200180602001838103835285818151815260200191508051906020019080838360005b8381101561022757808201518184015260208101905061020c565b50505050905090810190601f1680156102545780820d805160018360200d6101000a0d1916815260200191505b50838103825284818151815260200191508051906020019080838360005b8381101561028d578082015181840152602081019050610272565b50505050905090810190601f1680156102ba5780820d805160018360200d6101000a0d1916815260200191505b5094505050505060405180910390f35b3480156102d657600080fd5b506102df6106ac565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561031f578082015181840152602081019050610304565b50505050905090810190601f16801561034c5780820d805160018360200d6101000a0d1916815260200191505b509250505060405180910390f35b606060028054806020026020016040519081016040528092919081815260200182805480156103de57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610394575b5050505050905090565b604080519081016040528083815260200182815250600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082015181600001908051906020019061045892919061074a565b50602082015181600101908051906020019061047592919061074a565b5090505060028390806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050505050565b606080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010181805460018160011615610100020d166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020d166002900480156106005780601f106105d557610100808354040283529160200191610600565b820191906000526020600020905b8154815290600101906020018083116105e35782900d601f168201915b5050505050915080805460018160011615610100020d166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020d1660029004801561069c5780601f106106715761010080835404028352916020019161069c565b820191906000526020600020905b81548152906001019060200180831161067f5782900d601f168201915b5050505050905091509150915091565b6000805460018160011615610100020d166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020d166002900480156107425780601f1061071757610100808354040283529160200191610742565b820191906000526020600020905b8154815290600101906020018083116107255782900d601f168201915b505050505081565b82805460018160011615610100020d166002900490600052602060002090601f016020900481019282601f1061078b57805160ff19168380011785556107b9565b828001600101855582156107b9579182015b828111156107b857825182559160200191906001019061079d565b5b5090506107c691906107ca565b5090565b6107ec91905b808211156107e85760008160009055506001016107d0565b5090565b905600a165627a7a72305820188856774de50ae4d9e18778a81162b1a80d9df9059bcf68ac9acbc73580b01a0029';
var contract = web3.ss.contract(abi);
var instance = contract.at('0xb29f995b1cdfae66d85664205e82bc6c8918cae5');
/* Don't modify */

// esss.shaAbi(JSON.stringify(abi)).then((shaResult) => {
//   var sha = JSON.parse(shaResult).abiSha3;
//   esss.searchUsingAbi(sha).then((searchResult) => {
//     console.log(searchResult);
//   });
// });

document.querySelector("#s").addEventListener("click", function() {
  var n = window.prompt("Enter the number:");
  n && instance.set(n);
});
document.querySelector("#g").addEventListener("click", function() {
  console.log(instance.get().toString());
  alert(instance.get().toString());
});
$(function() {
  reload();
});

function reload() {
    $("#greeting").html(instance.greeting());
    web3.ss.getAccounts(function (e, address) {
        if (!e) {
            var result = instance.getNameComment(address);
            if (result[0]) {
                $("#form").css("display", "none");
                $("#me").css("display", "block");
                $("#myname").html(result[0]);
            }
            
            var likes = "";
            var addrs = instance.getAddrs();
            addrs.forEach(function(addr) {
                result = instance.getNameComment(addr);
                likes = likes + "<tr><td>" + result[0] + "</td><td>" + result[1] + "</td></tr>";
            });
            $("#likes").html(likes);
        }
    });
}

$("#submit").click(function() {
    if ((!$("#name").val().trim()) || (!$("#comment").val().trim())) {
      alert("Please enter both a name and a comment");
      return false;
    }
    web3.ss.getAccounts(function (e, address) {
        if (!e) {
            $("#submit").html("Wait ...");
            instance.addComment (address, $("#name").val(), $("#comment").val());
            setTimeout(function () {
                reload ();
            }, 3 * 1000);
        }
    });
    return false;
});
    </script>
  </body>
</html>